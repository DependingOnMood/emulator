<!DOCTYPE HTML>
<html lang="en" ng-app="myApp">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Real-time game example</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
  <link rel="stylesheet" type="text/css" href="http://yoav-zibin.github.io/emulator/main.css">
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular.js"></script>
  <script>
  angular.module('myApp', [])
    .controller('Ctrl',
        function ($timeout, $scope, $log, realTimeSimpleService) {
    'use strict';

    $scope.lines = [];

    function gotStartMatch(params) {
      $log.info("gotStartMatch:", params);
      var yourPlayerIndex = params.yourPlayerIndex;
      var playersInfo = params.playersInfo;
      $scope.lines = [
        "yourPlayerIndex=" + yourPlayerIndex,
        "playersInfo:",
        angular.toJson(playersInfo)
      ];

      $timeout(function () {
        realTimeSimpleService.sendReliableMessage('Reliable');
        $timeout(function () {
          realTimeSimpleService.sendUnreliableMessage('Unreliable');
          $timeout(function () {
            var endMatchScores = [];
            for (var i = 0; i < playersInfo.length; i++) {
              endMatchScores.push(42 + i);
            }
            realTimeSimpleService.endMatch(endMatchScores);
          }, 1000);
        }, 1000);
      }, 1000);
    }

    function gotMessage(params) {
      $log.info("gotMessage:", params);
      var fromPlayerIndex = params.fromPlayerIndex;
      var message = params.message;
      $scope.lines.push("msg=" + message + " from " + fromPlayerIndex);
    }

    function gotEndMatch(endMatchScores) {
      $log.info("gotEndMatch:", endMatchScores);
      $scope.lines.push("end match scores=" + endMatchScores);
    }

    realTimeSimpleService.init({
      gotStartMatch: gotStartMatch,
      gotMessage: gotMessage,
      gotEndMatch: gotEndMatch
    });
  });
  </script>
  <script src="realTimeSimpleService.js"></script>
  <script src="resizeGameAreaService.js"></script>
  <script src="messageService.js"></script>
</head>
<body ng-cloak ng-controller="Ctrl">
  <div ng-repeat="line in lines track by $index">{{line}}</div>
</body>
</html>
